<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
</head>

<style>
  * {
    box-sizing: border-box;
  }
  .top{
  
    height: 20%;
    width: 100%;
    border-style: solid;
    border-width: 5px, auto;
    border-bottom-style: none;
    color: white;
    border-right-color: black;
    border-left-color: black;
    border-top-color: black;
  }
  .topbottom{
    border-left-style: solid;
    border-right-style: solid;
    border-width: 5px, auto;
  }
  .change{
    border-style:solid;
    border-radius: 12px;
    background-color: white;
    text-align: center;
    color: gray;
    border: solid;
  }
  .change:hover{
    border-style:solid;
    background-color: gray;
    text-align: center;
    color: white;
    cursor: pointer;
  }
  .logoutbutton{
    border: solid;
    background-color: white;
    text-align: center;
    color: gray;
    float: left;
    border-radius: 12px;
    width: 10%;
    height: 20%;
    font-size: 75%;
  }
  .logoutbutton:hover{
    border-style: solid;
    background-color: gray;
    text-align: center;
    color: white;
    float: left;
    cursor: pointer;
    border-radius: 12px;
  }
  .DeleteChannelbutton{
    border-style:solid;
    border-radius: 12px;
    background-color: black;
    text-align: center;
    color: rgb(207, 207, 207);
    border: solid;
  }
  .DeleteChannelbutton:hover{
    border-style:solid;
    border-radius: 12px;
    background-color: rgb(207, 207, 207);
    text-align: center;
    color: black;
    border: solid;
    cursor: pointer;
  }
  .LeaveChannelbutton{
    border-style: solid;
    border-radius: 12px;
    background-color: white;
    text-align: center;
    color: red;
    border: solid;
  }
  .LeaveChannelbutton:hover{
    border-style: solid;
    border-radius: 12px;
    background-color: red;
    text-align: center;
    color: white;
    border: solid;
    cursor: pointer; 
  }
  .chattext{
    position: absolute;
    bottom: 0%;
    width: 90%;
  }
  .sendbutton{
    position: absolute;
    bottom: 0;
    right: 0;
    width: 10%;
    height: 20px auto;
    font-size: 65%;
  }
  .chatitle{
    border-style: solid;
    border-top-style: none;
    border-left-style: none;
    border-right-style: none;
    border-color: black;
    color: rgb(68, 68, 68);
  }
  .chat{
    height: 80%;
    width: 80%;
    float: left;
    position: relative;
    border-style: solid;
    border-left-style: none;
    border-width: auto;
    border-color: black;
  }
  .chattop{
    height: 
  }
  .chatarea{
    height: 80%;
    position: absolute;
    bottom: 6%;
    overflow: scroll;
    border: solid;
    border-bottom-style: none;
    border-left-style: none;
  }
  .channels{
    padding-top: 10px;
    width: 20%;
    height: 80%;
    float: left;
    border-style: solid;
    border-width: 5px, auto;
    border-color: black;
    text-align: center;
    overflow: scroll;
    background-color: rgb(49, 49, 49);
  }
  .channelback{
    background-color: rgb(206, 206, 206);
    height: 100%;
    width: 100%; 
    border-top-style: solid;
    border-top-color: black;
    display: none;
  }
  .channelselect{
    width: 50%;
    height: 50%;
    background-color: rgb(71, 71, 71);
    position: absolute;
    top: 40%;
    bottom: 50%;
    left: 25%;
    border-color: black;
    border-style: solid;
  }
  .channelselectmain{
    position: absolute;
    top: 15%;
    line-height: 400%;
    width: 100%;
    color: white;
    text-align: center;
  }
  .channelselecttop{
    color:white;
    position: absolute;
    top: 5%;
    text-align: center;
    width: 100%;
  }
  .channelselectmid{
    background-color: white;
    position: absolute;
    right: 0%;
    color: white;
  }
  .channelselectbutton{
    border-style:solid;
    width: 75%;
    height: 400%;
    border-radius: 12px;
    background-color: white;
    text-align: center;
    color: gray;
    border: solid;
  }
  .channelselectbutton:hover{
    border-style:solid;
    width: 75%;
    height: 400%;
    background-color: gray;
    text-align: center;
    color: white;
    cursor: pointer;
  }
  .PMuserfind{
    width: 100%;
    height: 100%;
    background-color: rgb(206, 206, 206);
    display: none;
    position: relative;
  }
  .PMuserfindbox{
    width: 50%;
    height: 30%;
    background-color: rgb(71, 71, 71);
    position: absolute;
    left: 25%;
    bottom: 50%;
    border-style: solid;
    border-color: black;

  }
  .usersearchinput{
    position: absolute;
    left: 27%;
    top: 25%;
    color: white;
    text-align: center;
  }
  .userfinddropdown{
    position: absolute;
    display: inline-block;
    background-color: rgb(201, 201, 201);
    overflow: auto;
    border-style: solid;
    padding: 12px 16px;
    border-color: black;
    left: 15%;
    top: 45%;
    width: 70%;
    list-style-type: none;
    text-align: center;
  }
  .userfinddropdown li{
    border-style: solid;
    border-color: black;
    color: white;
    background-color: rgb(48, 46, 46);
  }
  .userfinddropdown li:hover{
    border-style: solid;
    border-color: black;
    color:rgb(48, 46, 46);
    background-color: white;
    cursor: pointer;
  }
  .tabs{
    position: relative;
  }
  .channeltab{
    width: 50%;
    font-size: 75%;
    color: white;
    position: absolute;
    left: 0%;
    border-style: solid;
    border-color: black;
    background-color: gray;
  }
  .PMtab{
    width: 50%;
    font-size: 75%;
    color: white;
    position: absolute;
    right: 0%;
    border-style: solid;
    border-color: black;
    background-color: gray;
  }
  .channeltab:hover{
    width: 50%;
    font-size: 75%;
    color: gray;
    position: absolute;
    left: 0%;
    border-style: solid;
    border-color: black;
    background-color: white;
    cursor: pointer;
  }
  .PMtab:hover{
    width: 50%;
    font-size: 75%;
    color: gray;
    position: absolute;
    right: 0%;
    border-style: solid;
    border-color: black;
    background-color: white;
    cursor: pointer;
  }
  .channeltab:focus{
    width: 50%;
    font-size: 75%;
    color: gray;
    position: absolute;
    left: 0%;
    border-style: solid;
    border-bottom-style: none;
    border-color: black;
    background-color: white;
    cursor: pointer;
  }
  .PMtab:focus{
    width: 50%;
    font-size: 75%;
    color: gray;
    position: absolute;
    right: 0%;
    border-style: solid;
    border-bottom-style: none;
    border-color: black;
    background-color: white;
    cursor: pointer;
  }
  .channelsmenu{
    display: block;
  }
  .PMmenu{
    display: none;
  }
  .optionbutton{
    border-style:solid;
    border-radius: 12px;
    width: 15%;
    background-color: white;
    text-align: center;
    color: black;
    border: solid;
  }
  .optionbutton:hover{
    border-style:solid;
    background-color: gray;
    border-radius: 12px;
    width: 15%;
    text-align: center;
    color: white;
    cursor: pointer;
  }
  .options{
    position: absolute; 
    width: 100%;
    height: 50%;
    display: none;
    background-color: rgb(66, 66, 66);
    border-style: solid;
  }
  .sharelinkbut{
    border-style:solid;
    border-radius: 12px;
    background-color: white;
    text-align: center;
    color: gray;
    border: solid;
    position: absolute;
  }
  .sharelinkbut:hover{
    border-style:solid;
    border-radius: 12px;
    background-color: gray;
    text-align: center;
    color: white;
    border: solid;
    position: absolute;
    cursor: pointer;
  }
  .sharelinkbox{
    width: 30%;
    height: 10%;
    border-style: solid;
    border-color: black;
    background-color: rgb(71, 71, 71);
    position: absolute;
  }
  .innersharelinkbox{
    width: 75%;
    height: 75%;
    text-align: center;
    background-color: white;
    position: absolute;
    right: 10%;
    top: 10%;
  }
  .chatbub{
    height: 90px;
    width: 90px;
    color: black;
    background-color: white;
    border: none;
    border-radius: 50%;
    display: inline-block;
    position: relative;
    transition: transform .5s;
    cursor: pointer;
    margin: auto;
  }
  .notificationmarkchat{
    color: white;
    background-color: red;
    border-radius: 40%;
    text-align: center;
    width: 50%;
    height: 25%;
    position: absolute;
    top: 0%;
    right: 0%;
    display: none;
  }
  .notificationmarkSchat{
    color: white;
    background-color: red;
    border-radius: 40%;
    text-align: center;
    width: 20%;
    height: 35%;
    position: absolute;
    top: 0%;
    right: 0%;
    display: none;
  }
  .notificationmarktab{
    color: white;
    background-color: red;
    text-align: center;
    font-size: 95%;
    width: 10%;
    height: 100%;
    position: absolute;
    top: 0%;
    left: 0%;
    display: none;
  }
  .smallchatbub{
    height: 40px;
    width: 100%;
    border-style: solid;
    border-width: 3.5px;
    border-color: black;
    background-color: gray;
    font-family: fantasy;
    font-size-adjust: 0.5; 
    border-radius: 12px;
    text-align: center;
    text-decoration: none;
    text-size-adjust: auto;
    position: relative;
    float: left;
    overflow: hidden;
    font-size: 10px;
    cursor: pointer;
  }
  .smallchatbub:focus{
    height: 40px;
    width: 100%;
    border-style: solid;
    border-width: 3.5px;
    border-color: black;
    background-color: white;
    font-family: fantasy;
    font-size-adjust: 0.5; 
    border-radius: 12px;
    text-align: center;
    text-decoration: none;
    text-size-adjust: auto;
    position: relative;
    float: left;
    overflow: hidden;
    font-size: 10px;
    cursor: pointer;
  }
  .chatbub:hover{
    transform: scale(1.2)
  }
  @media only screen and (min-width: 551px)
  {
  .tabs{
    position: relative;
  }
  .channeltabtext{
      position: absolute;
      top: 23%;
      right: 30%;
  }
  .channeltab{
    width: 50%;
    font-size: 75%;
    color: white;
    position: absolute;
    left: 0%;
    border-style: solid;
    border-color: black;
    background-color: gray;
  }
  .PMtab{
    width: 50%;
    font-size: 75%;
    color: white;
    position: absolute;
    right: 0%;
    border-style: solid;
    border-color: black;
    background-color: gray;
  }
  .channels{
      width: 25%;
  }
  .chat{
      width: 75%;
  }
  .chatarea{
    width: 100%;
  }  
  }
  @media only screen and (max-width: 550px)
  {
    .tabs{
      top: 5%;
    }
    .channeltab
    {
      width: 100%;
      position: absolute;
      top: 0%;
      font-size: 60%;
    }
    .channeltabtext{
      position: absolute;
      top: 23%;
      right: 23%;
    }
    .PMtab
    {
      width: 100%;
      font-size: 60%;
      position: absolute;
      bottom: 0%;
    }
    .channeltab:hover{
    width: 100%;
    font-size: 60%;
    top: 0%;
    color: gray;
    position: absolute;
    border-style: solid;
    border-color: black;
    background-color: white;
    cursor: pointer;
    
  }
  .channeltab:focus{
    width: 100%;
    font-size: 60%;
    top: 0%;
    color: gray;
    position: absolute;
    border-style: solid;
    border-color: black;
    background-color: white;
    cursor: pointer;
    border-bottom-style: none;
  }
  .PMtab:hover{
    width: 100%;
    font-size: 60%;
    bottom: 0%;
    color: gray;
    position: absolute;
    border-style: solid;
    border-color: black;
    background-color: white;
    cursor: pointer;
  }
  .PMtab:focus{
    width: 100%;
    font-size: 60%;
    bottom: 0%;
    color: gray;
    position: absolute;
    border-style: solid;
    border-color: black;
    background-color: white;
    cursor: pointer;
    border-bottom-style: none;
  }
  .top{
    height: 15%;
  }
  .logoutbutton{
    border: solid;
    background-color: white;
    text-align: center;
    color: gray;
    float: left;
    border-radius: 12px;
    width: 20%;
    height: 30%;
    font-size: 75%;
  }
  .front{
    height: 85%;
  }
  .channelsmenu{
    position: absolute;
    top: 5%;
  }
  .PMmenu{
    position: absolute;
    top: 5%;
  }
  .channels{
    position: relative;
    width: 25%;
  }
  .chat{
    width: 75%;
  }
  .sendbutton{
    font-size: 75%;
    bottom: 0%;
    width: 100%;
    height: 7%;
  }
  .chattext{
    bottom: 6.5%;
    width: 100%;
  }
  .chatarea{
    font-size: 85%;
    width: 100%;
  }
  .chatitle{
    font-size: 150%;
  }
}
</style>
<div class="topbackground" style="background-color:rgb(68, 68, 68)">
  <div class=top>
    <h1 id=text></h1>
      <input class=logoutbutton type="submit" onclick='logginout()' value="Logout" />
    <h3><center>B<sup>3</sup></center></h3>
  </div>      
  
    <div class=topbottom style="background-color:rgb(68, 68, 68)">
    </div>
</div>

<body >
<div id=front>
<div id=chan class="container-fluid, channels">
  <div class=tabs style=position:relative>
    <button id=channeltab class=channeltab onclick="tabbutton(0)"><div class="channeltabtext">Channels</div>
    <br>
    <br>
    <div class="notificationmarktab"><div style="transform: rotate(90deg)">blah!</div></div></button>
    <button id=PMtab class=PMtab onclick="tabbutton(1)">Private<div class="notificationmarktab"><div style="transform: rotate(90deg)">blah!</div></div> 
      <br>
      Messages</button>
  </div >
  <div class="channelsmenu" id="channelsmenu">
    <br>
    <br>
    <button class=change style=float:left onclick="channelbox(false)">+</button>
    <br>
  </div>
  <div class="PMmenu" id="PMmenu">
    <br>
    <br>
    <button class=change style=float:left onclick="PMsearchbox(false)">+PM</button> 
    <br>
    <br>
  </div>
</div>



<div id="back" class="container-fluid, chat">
    <div class="chattop">  
    <button id="settings" onclick="ToOP(false)" class="change">Channel Settings</button>
      <h1 class=chatitle id="Boldname">THIS IS A CHAT</h1>
    </div>
      
      <div id="chatarea" class='chatarea'>
      </div>
      <form id='mes' method="POST" action='#'> 
      <input id="usertext" class="container-fluid, chattext" name="usertext" type=text placeholder=message autocomplete=off /><input class="sendbutton" type=submit value=Send />
      </form>

</div>
</div>
<div class="options" id=OPback>
<button class='change' id=Close onclick="ToOP(true)">X</button>
<br>
<button class=change onclick="backgroundcolor('rgb(68, 68, 68)'), textcolor('white')">Dark background</button>
<button class=change onclick="backgroundcolor('white'), textcolor('rgb(68, 68, 68)')">Light background</button>
<br>
<button onclick="newchat()" class=change id="small" >+Chat</button>
<br>
<button class="change, sharelinkbut" onclick="sharelinkbut(false)" id="sharelinkbut">+Invite</button>
<div class="sharelinkbox" id="sharelinkbox" style='display: none'>
  <button class='change' id='linkclose' onclick='sharelinkbut(true)'>x</button>
  <div class="innersharelinkbox" id='linkinsert'> 
  </div>
  <br>
</div>
<br>
<br>
<button class="DeleteChannelbutton" id="DelChanBut" onclick="DeleteChannel()">Delete Channel</button>
<br>
<button class="LeaveChannelbutton" id="LevChanBut" onclick="">Leave Channel</button>
</div>

<div class="channelback" id="channelbox">
  <div class="channelselect">
    <button class='change' onclick='channelbox(true)'>x</button>
    <br>
    <div class="channelselecttop">CHANNEL</div>
    <div class="channelselectmain">  
      <button class="channelselectbutton" onclick="joinchannel()">Join</button>
      <br>
      or
      <br>
      <button class="channelselectbutton" onclick="newchannelbut()">Create</button>
    </div>
  </div>
</div>

<div class="PMuserfind" id="PMuserfind">
  <div class="PMuserfindbox"> 
    <button class=change onclick="PMsearchbox(true)">x</button>
    <div class="usersearchinput">
      Find Users:
      <br>
      <input type=text name=usersearch id=userinput placeholder="Enter friend's username" onkeyup="usersearch()" /> 
      <br>
    </div>
    <ul class="userfinddropdown" id="userfinddropdown">
      
    </ul>  
  </div>
</div>

</body>
<script
			  src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
			  integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E="
        crossorigin="anonymous"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
<script type="text/javascript" charset="utf-8">
var channelplace = null;
var chatplace = null;
var focelem = null;
var x = 0;
var CHNN = null;
var check = false;
var firstchat = true;
var lstid = null;
var user = null;
var channeload = false;
var chatload = false;
var PMload = false;
var activechat = null;
var load = false;
var connect = false;
var userinput = null;
var PM = false;
var activePM = null;
var elem = null;
$(document).ready(function()
{
  
  namespace = '/test';

  var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);
  
  if(connect == false)
  {
    socket.on('connect', function()
      {
        connect = true;
        socket.emit('connectdone')
      })
  }
  
  socket.on('confirmjoinmessage', function(msg)
  {
    $('#chatarea').append('<br>' + msg.data);
  })
  socket.on('confirmjoin', function(msg)
  {
    if(msg.select == 'nochannel')
    {
      console.log('channel does not exist');
    }
    else
    {
      var channelbox = document.getElementById("channelbox");
      var front = document.getElementById("front");
      channelbox.style.display = "none";
      front.style.display = "block";
    }
  })
  socket.on('PMinfo', function(msg){
    newPM(msg.sender, true);
    socket.emit('PMjoin', {sender: msg.sender, recieve: 'true'})
  })
  socket.on('userdata', function(msg)
  {
    if(msg.data == " ")
    {
      if(msg.sentdata == 'channel')
      {
        channeload = true;
      }
      if(msg.sentdata == 'PM')
      {
        PMload = true;
      }
    }
    else
    {
      if(msg.sentdata == "channel")
      {
        if(msg.owner == "true")
        {
          channeload = false;
          newchannel(msg.data, true);

        }
        else
        {
          channeload = false;
          newchannel(msg.data, false);
        }
      }
      if(msg.sentdata == "PM")
      {
        newPM(msg.data, true);
      }
    }
  })
  socket.on('userssend', function(msg)
  {
    var li = document.createElement("li");
    li.textContent = msg.user;
    li.addEventListener('click', newPM)
    $('#userfinddropdown').append(li)
  })
  socket.on('sharelinksend', function(msg)
  {
    $('#linkinsert').append(msg.data);
  })

  socket.on('usermessage', function(msg) 
  {
    if(PM == true)
    {
      if(msg.PM == 'false')
      {
        $("#channeltab").find("div").css("display", "block");
      }
    }
    if(PM == false)
    {
      if(msg.PM == 'true')
      {
        $("#PMtab").find("div").css("display", "block");
      }
    }
    if(msg.PM == 'true')
    {
      if(msg.reciever == "_")
      {
        if(activePM != msg.sender)
        {
          var PMS = $("#PMmenu").find("button");
          for(var i = 0; PMS.length != i; i++)
          {
            var NM = PMS[i].childNodes;
            if(PMS[i].textContent.slice(0, PMS[i].textContent.length - 5) == msg.sender)
            {
              NM[1].style.display = "block";
            }
          }
        }
        else
        {
          $('#chatarea').append('<br>' + "<sup>" + msg.DT + "</sup>" + msg.userm);  
        }
      }
      if(msg.sender == "_")
      {
        if(msg.reciever == document.getElementById("Boldname").textContent)
        {
          $('#chatarea').append('<br>' + "<sup>" + msg.DT + "</sup>" + msg.userm); 
        }
      }
    }
    else
    {
      if(msg.UPchannel == CHNN)
      {
        if(msg.UPchat == activechat)
        {
          $('#chatarea').append('<br>' + "<sup>" + msg.DT + "</sup>" + msg.userm); 
        }
        else
        { 
          
          if(msg.UPchat == "#general")
          {
            var notifiedC = document.getElementsByClassName(msg.UPchannel + "channel");
            notifiedC = notifiedC[0].childNodes;
            notifiedC = notifiedC[0].childNodes;
            notifiedC[1].style.display = "block";  
          }
          else
          {
            var notifiedC = document.getElementsByClassName(msg.UPchannel + "channel");
            notifiedC = notifiedC[0].childNodes;
            notifiedC = notifiedC[1].childNodes;
            for(var i = 0; notifiedC.length != i; i++)
            {
              var tempname = notifiedC[i].textContent.slice(0, notifiedC[i].textContent.length - 5);
              if(tempname == msg.UPchat)
              {
                var temp = notifiedC[i].childNodes;
                temp[1].style.display = "block";
              }
            }           
          }
        }
      }
      else
      {
        var tempchan = document.getElementsByClassName(msg.UPchannel + "channel");
        if(tempchan[0].parentElement.id == 'true')
        {
          if(msg.UPchat == "#general")
          {
            var notifiedC = tempchan;
            notifiedC = notifiedC[0].childNodes;
            notifiedC = notifiedC[0].childNodes;
            notifiedC[1].style.display = "block";  
          }
          else
          {
            var notifiedC = tempchan;
            notifiedC = notifiedC[0].childNodes;
            notifiedC[0].childNodes[1].style.display = "block";
            notifiedC = notifiedC[1].childNodes;
            for(var i = 0; notifiedC.length != i; i++)
            {
              var tempname = notifiedC[i].textContent.slice(0, notifiedC[i].textContent.length - 5);
              if(tempname == msg.UPchat)
              {
                var temp = notifiedC[i].childNodes;
                temp[1].style.display = "block";
              }
            }
          }
        }
        else
        {
          var notifiedC = document.getElementsByClassName(msg.UPchannel + "channel");
          notifiedC = notifiedC[0].childNodes;
          notifiedC = notifiedC[0].childNodes;
          notifiedC[1].style.display = 'block';          
          socket.emit('useresponse', {UPchannel: msg.UPchannel, UPchat: msg.UPchat, data: "", DOWNchannel: CHNN, DOWNchat: activechat, PM: 'false', DT: msg.DT, sender: msg.sender})
        }
      }
    }
  });

  socket.on('username', function(msg)
  {
    $('#text').append(msg.data);
    user = msg.data;
    if(document.getElementById("channelsmenu").getElementsByTagName("div").length != 0)
      {
        document.getElementById("channelsmenu").getElementsByTagName("div")[0].getElementsByClassName("chatbub")[0].click();
      }
      else
      {
        var x = document.getElementById("small");
        var Chansets = document.getElementById("settings");
        var thelink = document.getElementById("sharelinkbut");
        x.style.display = "none";
        Chansets.style.display = "none";
        thelink.style.display = "none";
      }
  })
  
  socket.on('messageload', function(msg)
  {
    if(load == false)
    { 
      $('#chatarea').append('<br>' + "<sup>" + msg.DT + "</sup>" + msg.userm); 
    }
  })

  socket.on('messageloaddone', function()
  {
    load = true;
  })

  $('form#mes').submit(function(event)
  {
      if(PM == true)
      {
        socket.emit('useresponse', {data: document.getElementById('text').textContent +  ': ' + $('#usertext').val(), PM: 'true', sender: user, reciever: document.getElementById("Boldname").textContent});
        event.preventDefault();
        $('#usertext').val('');
      }
      else
      {
        socket.emit('useresponse', {data: document.getElementById('text').textContent +  ': ' + $('#usertext').val(), DOWNchannel: CHNN, DOWNchat: activechat, UPchannel: CHNN, UPchat: activechat, PM: 'false'});
        event.preventDefault();
        $('#usertext').val('');
      }
  });

  socket.on('send', function(msg)
  {
    if(msg.notify == 'true')
    {
      newchat(msg.data[0], true)
    }
    else
    {
      newchat(msg.data[0], false);
    }
  });
  socket.on('done', function()
  {
    focelem.parentElement.id = 'true';
    var thechats =  document.getElementsByClassName(CHNN + "channel")[0]
    thechats = thechats.childNodes[1];
    thechats = thechats.childNodes;
    for(var i = 0; thechats.length != i; i++)
    {
    var selector = document.getElementsByClassName(CHNN + "channel")[0]
    selector = selector.getAttribute("activechat"); 
    var SELchat = thechats[i].textContent.slice(0, thechats[i].textContent.length - 5)
    if(SELchat ==  selector)
      {
        thechats[i].click();
      } 
    }
    firstchat = true; 
    var chats = null;          
    chats = "chat" + focelem.id;
    elem = document.getElementById(chats);
  })
}); 

function textcolor(TColor) 
{
  var elem = document.getElementById('Boldname');
  var chat_text = document.getElementById("chatarea");
  elem.style.color = TColor;
  chat_text.style.color = TColor;
}
function backgroundcolor(BKcolor)
{
  var elem = document.getElementById('back');
  elem.style.backgroundColor = BKcolor;
}
function smallchan() 
{
  var c = document.createElement("button");
  c.setAttribute("class", "smallchatbub");
  c.setAttribute("id", "small");
}
function ToOP(close)
{
  var chosen = document.getElementById("settings");
  var thefront = document.getElementById("front");
  var options = document.getElementById("OPback");
  
  if(close == true)
  {
    options.style.display = "none";
    thefront.style.display = "block";
  }
  else
  {
    thefront.style.display = "none";
    options.style.display = "block";
  }
}
function logginout()
{
  namespace = '/test';

  var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);
  socket.emit('logout');
}
function options()
{

}
function tabbutton(flip)
{
  var allchannels = document.getElementById("channelsmenu");
  var allPM = document.getElementById("PMmenu");
  if(flip == 1)
  {
    PM = true;
    allchannels.style.display = 'none';
    allPM.style.display = 'block';
    $("#chatarea").empty();
    $("#PMtab").find("div").css("display", "none");
    if($("#PMmenu").find(".chatbub").length > 0)
    {
      var Selchat = $("#PMmenu").find(".chatbub")[0];
      var tempname = Selchat.textContent.slice(0, Selchat.textContent.length - 5);
      $("#Boldname").text(tempname);
      $("#chatbuttons").children().css('display', 'none');
      var PMS = $("#PMmenu").find("button");
      PMS[1].click();
    }
    else
    {
      PM = true;
      $("#Boldname").empty();
      $("#chatbuttons").children().css('display', 'none');
    }
    
  }
  else
  {
    allPM.style.display = 'none';
    allchannels.style.display = 'block';
    var chansettings = document.getElementById('settings');
    chansettings.style.display = "block";
    var NM = $("#channeltab").find("div");
    NM[1].style.display = "none";
    PM = false;
    var clickchannel = document.getElementsByClassName(CHNN + "channel");
    if(activechat == "#general")
    {
      clickchannel = clickchannel[0].childNodes;
      clickchannel[0].click();
    }
    else
    {
      clickchannel = clickchannel[0].childNodes;
      clickchannel = clickchannel[1].childNodes;
      for(var i = 0; clickchannel.length != i; i++)
      {
        if(clickchannel[i].textContent.slice(0, clickchannel[i].textContent.length - 5) == activechat)
        {
          clickchannel[i].click();
        }
      } 
    }
  }
}
function disp()
{
  namespace = '/test';

  var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);

  load = false;
  var x = document.getElementById("small");
  var HLName = document.getElementById("Boldname");
  var Chansets = document.getElementById("settings");
  var thelink = document.getElementById("sharelinkbut");
  if(PM == true)
  {
    HLName.style.height = '15%';
    $("#chatarea").empty()
    if(this.id == lstid)
    {
      x.style.display = "none";
      HLName.textContent = this.textContent.slice(0, this.textContent.length - 5);
      Chansets.style.display = "none";
      lstid = this.id;
      focelem = this;
      elem = null;
      activePM = this.textContent.slice(0, this.textContent.length - 5);
      var notify = this.childNodes;
      if(notify[1].style.display = 'block')
      {
        notify[1].style.display = 'none';
      }
    }
    else
    {
      x.style.display = "none";
      HLName.textContent = this.textContent.slice(0, this.textContent.length - 5);
      Chansets.style.display = "none";
      lstid = this.id;
      elem = null;
      focelem = this;
      activePM = this.textContent.slice(0, this.textContent.length - 5);
      var notify = this.childNodes;
      if(notify[1].style.display = 'block')
      {
        notify[1].style.display = 'none';
      }
    }
    socket.emit('messagepull', {PM: 'true', sender: user, reciever: this.textContent.slice(0, this.textContent.length - 5)});
  }
  else
  {
    if(check == false)
    {
      CHNN = this.textContent.slice(0, this.textContent.length - 5)
      check = true;
    }
    if(this.className == "smallchatbub")
    {
        this.closest("div").parentElement.setAttribute("activechat", this.textContent.slice(0, this.textContent.length - 5))
        HLName.textContent = CHNN + ": " + this.textContent.slice(0, this.textContent.length - 5);
        HLName.style.height = '9%';
        activechat = this.textContent.slice(0, this.textContent.length - 5);
        $('#chatarea').empty();
        socket.emit('messagepull', {chat: activechat, channel: CHNN, PM: 'false', sender: "", reciever: ""})
        var notify = this.childNodes;
        if(notify[1].style.display = 'block')
        {
          notify[1].style.display = 'none';
        }
    }
    else
    {
      var chats = null;    
      if(this.closest("div").id == lstid)
      {
        focelem = this.closest("div");
        if(focelem.parentElement.id == 'true')
        {
          if(focelem.parentElement.getAttribute("owner") == 'true')
          {
            $("#DelChanBut").css("display", "block");
            $("#LevChanBut").css("display", "none");
          }
          else
          {
            $("#DelChanBut").css("display", "none");
            $("#LevChanBut").css("display", "block");
          }
          CHNN = this.textContent.slice(0, this.textContent.length - 5);
          chats = "chat" + focelem.id;
          elem = document.getElementById(chats);
          var thechats =  document.getElementsByClassName(CHNN + "channel")[0]
          thechats = thechats.childNodes[1];
          thechats = thechats.childNodes;
          for(var i = 0; thechats.length != i; i++)
          {
            var selector = document.getElementsByClassName(CHNN + "channel")[0]
            selector = selector.getAttribute("activechat"); 
            var SELchat = thechats[i].textContent.slice(0, this.textContent.length - 5)
            if(SELchat ==  selector)
            {
              thechats[i].click();
            } 
          }
          var notify = this.childNodes;
        if(notify[1].style.display = 'block')
        {
         notify[1].style.display = 'none';
        }
        lstid = this.closest("div").id;
        firstchat = false; 
        }
        else
        {
          if(focelem.parentElement.getAttribute("owner") == 'true')
          {
            $("#DelChanBut").css("display", "block");
            $("#LevChanBut").css("display", "none");
          }
          else
          {
            $("#DelChanBut").css("display", "none");
            $("#LevChanBut").css("display", "block");
          }
          CHNN = this.textContent.slice(0, this.textContent.length - 5);
          socket.emit("chatpull", {channelname: CHNN});
          chats = "chat" + focelem.id;
          elem = document.getElementById(chats);
          console.log(elem);
          var notify = this.childNodes;
          if(notify[1].style.display = 'block')
          {
            notify[1].style.display = 'none';
          } 
          lstid = this.closest("div").id;
        }
      }
      else
      { 
        if(elem != null)
        {
          if(focelem.getElementsByTagName("*").length == 2)
          {
            x.style.display = "block";
            Chansets.style.display = "block";
            thelink.style.display = "block";
            HLName.style.height = '9%';
          }
          else
          {
            chats = "chat" + focelem.id;
            elem = document.getElementById(chats);
            x.style.display = "block";
            elem.style.display = "none";
            Chansets.style.display = "block";
            thelink.style.display = "block";
            HLName.style.height = '9%';
          }
        }    
        focelem = this.closest("div");
        if(focelem.parentElement.id == 'true')
        {
          if(focelem.parentElement.getAttribute("owner") == 'true')
          {
            $("#DelChanBut").css("display", "block");
            $("#LevChanBut").css("display", "none");
          }
          else
          {
            $("#DelChanBut").css("display", "none");
            $("#LevChanBut").css("display", "block");
          }
          CHNN = this.textContent.slice(0, this.textContent.length - 5);
          var notify = this.childNodes;
          if(notify[1].style.display = 'block')
          {
            notify[1].style.display = 'none';
          }
          lstid = this.closest("div").id;
          chats = "chat" + focelem.id;
          elem = document.getElementById(chats);
          elem.style.display = "block";
          var thechats =  document.getElementsByClassName(CHNN + "channel")[0]
          thechats = thechats.childNodes[1];
          thechats = thechats.childNodes;
          for(var i = 0; thechats.length != i; i++)
          {
          var selector = document.getElementsByClassName(CHNN + "channel")[0]
          selector = selector.getAttribute("activechat"); 
          var SELchat = thechats[i].textContent.slice(0, thechats[i].textContent.length - 5)
          if(SELchat ==  selector)
            {
              thechats[i].click();
            } 
          }
          firstchat = false;
        }
        else
        {
          if(focelem.parentElement.getAttribute("owner") == 'true')
          {
            $("#DelChanBut").css("display", "block");
            $("#LevChanBut").css("display", "none");
          }
          else
          {
            $("#DelChanBut").css("display", "none");
            $("#LevChanBut").css("display", "block");
          }
          firstchat = true;
          CHNN = this.textContent.slice(0, this.textContent.length - 5);
          socket.emit("chatpull", {channelname: CHNN})
          var notify = this.childNodes;
          if(notify[1].style.display = 'block')
          {
            notify[1].style.display = 'none';
          } 
          lstid = this.closest("div").id;
        }
      } 
    }
  }
}
function PMsearchbox(close)
{
  var PM = document.getElementById("PMuserfind");
  var front = document.getElementById("front");
  if(close == true)
  {
    $("ul").empty();
    PM.style.display = 'none';
    front.style.display = 'block';
  }
  else
  {
    front.style.display = 'none';
    PM.style.display = 'block';
  }
}
function usersearch()
{
  namespace = '/test';
  var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);

  
  $('ul').empty();
  var input = $('#userinput').val();
  socket.emit('userspull', {data: input});
}
function search()
{
  namespace = '/test';
  var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);
  socket.emit("userspull");
}
function newPM(x, PMcheck)
{
  namespace = '/test';
  var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);
  
  var PM = document.getElementById("PMuserfind");
  var front = document.getElementById("front");
  var PMbub = document.createElement("button");
  var element = document.getElementById("PMmenu");
  var head = document.getElementById("Boldname");
  var br = document.createElement("br");
  var notification = document.createElement("div");

  if(PMcheck == true)
  {
    var chatuser = x;
  }
  else
  {
    var chatuser = x.target.textContent;  
    socket.emit('PMjoin', {sender: user, reciever: chatuser, recieve: ""});
  }
  if(activePM != chatuser)
  {

  }
  PMbub.className = "chatbub";
  PMbub.id = chatuser + 'PM';
  PMbub.addEventListener("click", disp)
  PMbub.append(chatuser);
  element.append(PMbub);
  element.append(br);
  element.append(br);
  notification.textContent = 'blah!';
  notification.className = "notificationmarkchat";
  PMbub.appendChild(notification);
  PM.style.display = "none";
  front.style.display = "block";
  $("ul").empty();
  $("#userinput").empty();
  head.style.display = "block";
  lstid = chatuser + 'PM';
  if(PMload == true)
  {
    notification.style.display = "block";
  }
}
function sharelinkbut(close)
{
  namespace = '/test';
  var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);

  var sharelinkbut = document.getElementById('sharelinkbut');
  var sharelinkbox = document.getElementById('sharelinkbox');
  if(close == true)
  {
    sharelinkbox.style.display = 'none';   
    sharelinkbut.style.display = 'block';
    $("#linkinsert").empty();
  }
  else
  {
    sharelinkbut.style.display = 'none';
    sharelinkbox.style.display = 'block';
    socket.emit("channelinkget", {channel: CHNN});
  }
}
function channelbox(close){
  var channelbox = document.getElementById("channelbox");
  var front = document.getElementById("front");
  if(close == true)
  {
    channelbox.style.display = "none";
    front.style.display = "block";
  }
  else
  {
    front.style.display = "none";
    channelbox.style.display = "block";
  }
}
function joinchannel()
{
  namespace = '/test';
  var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);

  var userchannelink = prompt("Insert channel link to join.", "")
  socket.emit('userjoin', {select: 'join', link: userchannelink})
 
}
function newchannelbut()
{
  var channelbox = document.getElementById("channelbox");
  var front = document.getElementById("front");
  channelbox.style.display = "none";
  front.style.display = "block";
  newchannel();
}
/////////////////////////////////
///Do a leave channel function///
/////////////////////////////////
function DeleteChannel()
{
  namespace = '/test';
  var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);

  var del = confirm("Delete this channel?");
  if(del == true)
  {
    socket.emit("userdelete", {channel: CHNN, select: 'channel'});
    var delelem = focelem.parentElement;
    delelem.parentNode.removeChild(delelem);
    elem = null;
    var clickelem = document.getElementById("channelsmenu").getElementsByClassName("load")[0]
    clickelem.childNodes[0].childNodes[0].click();
  }
  else
  {

  }
}
function newchannel(response, owner) 
{   
  namespace = '/test';
  var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);

  if(channeload == true)
  {
    var channelname = prompt("Name your new channel.", "");
  }
  else
  {
    var channelname = response;
  }
  var load = document.createElement("div");
  var channel = document.createElement("button");
  channelplace = document.createElement("div");
  var br =  document.createElement("br");
  var text = document.createTextNode(channelname);
  var element = document.getElementById("channelsmenu");
  var cl = channelname + "channel";
  var notification = document.createElement("div");
  var ACatt = document.createAttribute("Activechat");
  ACatt.value = "#general";
  channelplace.setAttributeNode(ACatt);
  firstchat = true;
  var channellink = joinchannel

  if(x == 0)
  {
    if(channelname == null || channelname == "")
    {
 
    }
    else
    { 
      if(channeload == true)
      {      
        element.appendChild(br);
        element.appendChild(load);
        load.setAttribute("id", "true");
        load.setAttribute("class", "load");
        channelplace.className = cl;
        channelplace.setAttribute("id", x);
        x = x + 1;
        load.appendChild(channelplace);
        channel.setAttribute("class", "chatbub");
        channel.addEventListener("click", disp);
        channel.appendChild(text);
        var str = 'blah!';
        notification.textContent = str.sup();
        notification.className = "notificationmarkchat";
        channelplace.appendChild(channel);
        channelplace.appendChild(notification);
        focelem = channelplace;
        lstid = channelplace.id;
        socket.emit('userjoin', {channel: channel.textContent.slice(0, channel.textContent.length - 5), select: 'channel'});
        newchat("general", 1);
        var isowner = document.createAttribute("owner");
        isowner.value = 'true';
        load.setAttributeNode(isowner);
      }
      else
      {
        element.appendChild(br);
        element.appendChild(load);
        load.setAttribute("id", "false");
        load.setAttribute("class", "load");
        channelplace.className = cl;
        channelplace.setAttribute("id", x);
        x = x + 1;
        load.appendChild(channelplace);
        channel.setAttribute("class", "chatbub");
        channel.addEventListener("click", disp);
        channel.appendChild(text);
        notification.textContent = 'blah!';
        notification.className = "notificationmarkchat";
        channel.appendChild(notification);
        channelplace.appendChild(channel);
        lstid = channelplace.id;
        focelem = channelplace;
        channeload = true;
        if(owner == true)
        {
          var isowner = document.createAttribute("owner");
          isowner.value = 'true';
          load.setAttributeNode(isowner);
        }
        else
        {
          var isowner = document.createAttribute("owner");
          isowner.value = 'false';
          load.setAttributeNode(isowner);
        }
      }
    }

  }
  else
  {
      
    if(channelname == null || channelname == "")
    {

    }
    else
    {
      if(channeload == true)
      {
        element.appendChild(br);
        element.appendChild(load);
        load.setAttribute("id", "true");
        load.setAttribute("class", "load");
        channelplace.className = cl;
        channelplace.setAttribute("id", x);
        x = x + 1;
        load.appendChild(channelplace);
        channel.setAttribute("class", "chatbub");
        channel.addEventListener("click", disp);
        channel.appendChild(text);
        notification.textContent = 'blah!';
        notification.className = "notificationmarkchat";
        channel.appendChild(notification);
        channelplace.appendChild(channel);
        lstid = channelplace.id;
        focelem = channelplace;
        socket.emit('userjoin', {channel: channel.textContent.slice(0, channel.textContent.length - 5), select: 'channel'});
        newchat("general", 1);
        var isowner = document.createAttribute("owner");
        isowner.value = 'true';
        load.setAttributeNode(isowner);        
      }
      else
      {
        element.appendChild(br);
        element.appendChild(load);
        load.setAttribute("id", "false");
        load.setAttribute("class", "load");
        channelplace.className = cl;
        channelplace.setAttribute("id", x);
        x = x + 1;
        load.appendChild(channelplace);
        channel.setAttribute("class", "chatbub");
        channel.addEventListener("click", disp);
        channel.appendChild(text);
        notification.textContent = 'blah!';
        notification.className = "notificationmarkchat";
        channel.appendChild(notification);
        channelplace.appendChild(channel);
        lstid = channelplace.id;
        focelem = channelplace;
        channeload = true;
        if(owner == true)
        {
          var isowner = document.createAttribute("owner");
          isowner.value = 'true';
          load.setAttributeNode(isowner);
        }
        else
        {
          var isowner = document.createAttribute("owner");
          isowner.value = 'false';
          load.setAttributeNode(isowner);
        }       
      }
    }

  }
  

}

function newchat(response, notify)
{
  namespace = '/test';
  var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);
  if(focelem.parentElement.id == 'true')
  {
    if(notify == 1)
    {
      var chatname = response
    }
    else
    {
      var chatname = prompt("Name your new chat.", "");
    }
  }
  else
  {
    var chatname = response;
  }

  var chat = document.createElement("button");
  var chats = "chat" + focelem.id;
  var notification = document.createElement("div");
  
  if(focelem.parentElement.id == 'true')
  {
    firstchat = false;
  }
  if(chatname == null || chatname == "")
  {
    
  }
  else
  {
    if(focelem.parentElement.id == 'true')
    {
      if(firstchat == false)
      {
        chatname = "#" + chatname;
        var text = document.createTextNode(chatname);
        chat.addEventListener("click", disp);
        chat.className = "smallchatbub";
        chat.appendChild(text);
        notification.textContent = 'blah!';
        notification.className = "notificationmarkSchat";
        chat.appendChild(notification);
        document.getElementById(chats).appendChild(chat);
        socket.emit('userjoin', {channel: focelem.firstChild.textContent.slice(0, focelem.firstChild.textContent.length - 5), select: 'chat', chatname: chatname})
      }
      else
      {
        chatname = "#" + chatname;
        var text = document.createTextNode(chatname);
        chatplace = document.createElement("div");
        chatplace.setAttribute("id", chats);
        firstchat = false;
        focelem.appendChild(chatplace);  
        chat.addEventListener("click", disp);
        chat.className = "smallchatbub";
        chat.appendChild(text);
        notification.textContent = 'blah!';
        notification.className = "notificationmarkSchat";
        chat.appendChild(notification);
        chatplace.appendChild(chat);
      }
    }
    else
    {
      if(firstchat == false)
      {
        var text = document.createTextNode(chatname);
        chat.addEventListener("click", disp);
        chat.className = "smallchatbub";
        chat.appendChild(text);
        notification.textContent = 'blah!';
        notification.className = "notificationmarkSchat";
        chat.appendChild(notification);
        document.getElementById(chats).appendChild(chat);
        if(notify == true)
        {
          notification.style.display = 'block';
        }
      }
      else
      {
        var text = document.createTextNode(chatname);
        chatplace = document.createElement("div");
        chatplace.setAttribute("id", chats);
        firstchat = false;
        focelem.appendChild(chatplace);  
        chat.addEventListener("click", disp);
        chat.className = "smallchatbub";
        chat.appendChild(text);
        notification.textContent = 'blah!';
        notification.className = "notificationmarkSchat";
        chat.appendChild(notification);
        chatplace.appendChild(chat);
        if(notify == true)
        {
          notification.style.display = 'block';
        }
      }
    }
  }
}
</script>
</html>