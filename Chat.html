<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
</head>

<style>
  * {
    box-sizing: border-box;
  }
  .top{
  
    height: 20%;
    width: 100%;
    border-style: solid;
    border-width: 5px, auto;
    border-bottom-style: none;
    color: white;
    border-right-color: black;
    border-left-color: black;
    border-top-color: black;
  }
  .topbottom{
    border-left-style: solid;
    border-right-style: solid;
    border-width: 5px, auto;
  }
  .change{
    border-style:solid;
    border-radius: 12px;
    background-color: white;
    text-align: center;
    color: gray;
    border: solid;
  }
  .change:hover{
    border-style:solid;
    background-color: gray;
    text-align: center;
    color: white;
    cursor: pointer;
  }
  .logoutbutton{
    border: solid;
    background-color: white;
    text-align: center;
    color: gray;
    float: left;
    border-radius: 12px;
    width: 10%;
    height: 20%;
  }
  .logoutbutton:hover{
    border-style: solid;
    background-color: gray;
    text-align: center;
    color: white;
    float: left;
    cursor: pointer;
    border-radius: 12px;
  }
  .chattext{
    position: absolute;
    bottom: 0;
    width: 90%;
  }
  .sendbutton{
    position: absolute;
    bottom: 0;
    right: 0;
    width: 10%
  }
  .chatitle{
    border-style: solid;
    border-top-style: none;
    border-left-style: none;
    border-right-style: none;
    border-color: black;
    color: rgb(68, 68, 68);
  }
  .chat{
    height: 80%;
    width: 80%;
    float: left;
    position: relative;
    border-style: solid;
    border-left-style: none;
    border-width: auto;
    border-color: black;
  }
  .chatarea{
    width: 100%;
    height: 76%;
    position: absolute;
    bottom: 6%;
  }
  .channels{
    padding-top: 10px;
    width: 20%;
    height: 80%;
    float: left;
    border-style: solid;
    border-width: 5px, auto;
    border-color: black;
    text-align: center;
    overflow: scroll;
    background-color: rgb(49, 49, 49);
  }
  .optionbutton{
    border-style:solid;
    border-radius: 12px;
    width: 15%;
    background-color: white;
    text-align: center;
    color: gray;
    border: solid;
  }
  .optionbutton:hover{
    border-style:solid;
    background-color: gray;
    border-radius: 12px;
    width: 15%;
    text-align: center;
    color: white;
    cursor: pointer;
  }
  .options{
    width: 50%;
    height: 50%;
    display: none;
  }
  .chatbub{
    height: 90px;
    width: 90px;
    color: black;
    background-color: white;
    border: none;
    border-radius: 50%;
    display: inline-block;
    position: relative;
    transition: transform .5s;
    cursor: pointer;
    margin: auto;
  }
  .smallchatbub{
    height: 40px;
    width: 100%;
    border-style: solid;
    border-width: 3.5px;
    border-color: black;
    background-color: gray;
    font-family: fantasy;
    font-size-adjust: 0.5; 
    border-radius: 12px;
    text-align: center;
    text-decoration: none;
    text-size-adjust: auto;
    position: relative;
    float: left;
    overflow: hidden;
    font-size: 10px;
    cursor: pointer;
  }
  .smallchatbub:focus{
    height: 40px;
    width: 100%;
    border-style: solid;
    border-width: 3.5px;
    border-color: black;
    background-color: white;
    font-family: fantasy;
    font-size-adjust: 0.5; 
    border-radius: 12px;
    text-align: center;
    text-decoration: none;
    text-size-adjust: auto;
    position: relative;
    float: left;
    overflow: hidden;
    font-size: 10px;
    cursor: pointer;
  }
  .chatbub:hover{
    transform: scale(1.2)
  }
</style>
<div style="background-color:rgb(68, 68, 68)">
  <div class=top>
    <h1 id=text></h1>
      <input class=logoutbutton type="submit" onclick='logginout()' value="Logout" />
    <h3><center>Blah Chat</center></h3>
  </div>      
  
    <div class=topbottom style="background-color:rgb(68, 68, 68)">
        <button class=change onclick="backgroundcolor('rgb(68, 68, 68)'), textcolor('white')">Dark background</button>
        <button class=change onclick="backgroundcolor('white'), textcolor('rgb(68, 68, 68)')">Light background</button>
    </div>
</div>

<body >
<div id=front>
<div id=chan class="container-fluid, channels">
  <button class=change style=float:left onclick=newchannel()>+</button>
  
  <br>
</div>

<div id="back" class="container-fluid, chat">
  
      <div>
        <button onclick=newchat() style=display:none class=change id="small" >+chat</button>
        <button id="settings" onclick="ToOP()" style="display: none" class="change">Channel Settings</button>
      </div>
      <h1 style="display: none;"class=chatitle id="Boldname"></h1>
      <div id="chatarea" class='chatarea'></div>
      <form id='mes' method="POST" action='#'> 
      <input id="usertext" class="container-fluid, chattext" name="usertext" type=text placeholder=message autocomplete=off /><input class="sendbutton" type=submit value=Send />
      </form>

</div>
</div>
<div class="options" id=OPback>
<button id=Close onclick="ToOP()">Close</button>

</div>
</body>
<script
			  src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
			  integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E="
        crossorigin="anonymous"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
<script type="text/javascript" charset="utf-8">
var channelplace = null;
var chatplace = null;
var focelem = null;
var x = 0;
var CHNN = null;
var check = false;
var num = 0;
var firstchat = true;
var lstid = null;
var number = 0;
var user = null;
var channeload = false;
var chatload = false;
$(document).ready(function()
{
  
  namespace = '/test';

  var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);
  
  socket.on('connect', function()
  {
    socket.emit('connected')
  })
  socket.on('confirmjoin', function(msg)
  {
    $('#chatarea').append('<br>' + msg.data);
  })
  socket.on('userdata', function(msg)
  {
    if(msg.data == " ")
    {
      channeload = true;
    }
    else
    {
      channeload = false;
      newchannel(msg.data);
    }
  })


  socket.on('usermessage', function(msg) 
  {
    $('#chatarea').append('<br>' + msg.data);
      
  });

  socket.on('username', function(msg){
    $('#text').append(msg.data);
    user = msg.data;
  })
  
  $('form#mes').submit(function(event)
  {
      socket.emit('useresponse', {data: document.getElementById('text').textContent +  ': ' + $('#usertext').val()});
      event.preventDefault();
      $('#usertext').val('');
  });

  socket.on('send', function(msg)
  {
    newchat(msg.data[0]);
  });
  socket.on('done', function()
  {
    focelem.parentElement.id = 'true';
  })
}); 


function textcolor(TColor) 
{
  var elem = document.getElementById('Boldname');
  elem.style.color = TColor;
}
function backgroundcolor(BKcolor)
{
  var elem = document.getElementById('back');
  elem.style.backgroundColor = BKcolor;
}
function smallchan() 
{
  var c = document.createElement("button");
  c.setAttribute("class", "smallchatbub");
  c.setAttribute("id", "small");
}
function ToOP()
{
  var chosen = document.getElementById("settings");
  var thefront = document.getElementById("front");
  var options = document.getElementById("OPback");
  
  if(this.className == chosen.className)
  {
    thefront.style.display = "none";
    options.style.display = "block";
  }
  else
  {
    options.style.display = "none";
    thefront.style.display = "block";
  }
}
function logginout()
{
  namespace = '/test';

  var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);
  socket.emit('logout');
}
function options()
{

}
function disp()
{
  namespace = '/test';

  var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);

  var x = document.getElementById("small");
  var HLName = document.getElementById("Boldname");
  var Chansets = document.getElementById("settings");
  
  var elem = null;
  if(check == false){
    CHNN = this.textContent;
    check = true;
  }
  if(this.className == "smallchatbub")
  {
    x.style.display = "none";
    HLName.textContent = CHNN + ": " + this.textContent;
    Chansets.style.display = "none";
  }
  else
  {
    var chats = null;    
    if(this.closest("div").id == lstid)
    {
      if(this.closest("div").parentElement.id == 'true')
      {
        CHNN = this.textContent;
        focelem = this.closest("div");
        chats = "chat" + focelem.id;
        elem = document.getElementById(chats);
        x.style.display = "block";
        Chansets.style.display = "block";
        HLName.style.display = "block";
        HLName.textContent = this.textContent + ": " + "#general";
      }
      else
      {
        socket.emit("chatpull", {channelname: focelem.firstChild.textContent});
        CHNN = this.textContent;
        focelem = this.closest("div");
        x.style.display = "block";
        Chansets.style.display = "block";
        HLName.style.display = "block";
        HLName.textContent = this.textContent + ": " + "#general";
      }
      
    }
    else
    {   
      if(focelem.getElementsByTagName("*").length == 1)
      {
        x.style.display = "block";
        Chansets.style.display = "block";
      }
      else
      {
        chats = "chat" + focelem.id;
        elem = document.getElementById(chats);
        x.style.display = "block";
        elem.style.display = "none";
        Chansets.style.display = "block";
      }
      focelem = this.closest("div");
      if(focelem.getElementsByTagName("*").length == 1)
      {
        if(focelem.parentElement.id == 'true')
        {
          CHNN = this.textContent;
          HLName.textContent = this.textContent + ": " + "#general";
          firstchat = true;
          lstid = this.closest("div").id;
          x.style.display = "block";
          Chansets.style.display = "block";
          
        }
        else
        {
          socket.emit("chatpull", {channelname: focelem.firstChild.textContent});
          
          CHNN = this.textContent;
          HLName.textContent = this.textContent + ": " + "#general";
          firstchat = true;
          lstid = this.closest("div").id;
          x.style.display = "block";
          Chansets.style.display = "block";
          HLName.style.display = "block";
                    
          
        }
      }
      else
      {
        CHNN = this.textContent;
        HLName.textContent = this.textContent + ": " + "#general";
        chats = "chat" + focelem.id;
        elem = document.getElementById(chats);
        elem.style.display = "block";
        lstid = this.closest("div").id;
      }   
    }
  }
}
function newchannel(response) 
{ 
  namespace = '/test';
  var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);
  if(channeload == true)
  {
    var channelname = prompt("Name your new channel.", "");
  }
  else
  {
    var channelname = response;
  }
  var load = document.createElement("div");
  var channel = document.createElement("button");
  channelplace = document.createElement("div");
  var br =  document.createElement("br");
  var text = document.createTextNode(channelname);
  var element = document.getElementById("chan");
  var cl = channelname + "channel";
  firstchat = true;

  if(x == 0)
  {
    if(channelname == null || channelname == "")
    {
 
    }
    else
    { 
      if(channeload == true)
      {      
        element.appendChild(br);
        element.appendChild(load);
        load.setAttribute("id", "true");
        load.setAttribute("class", "load");
        channelplace.className = cl;
        channelplace.setAttribute("id", x);
        x = x + 1;
        load.appendChild(channelplace);
        channel.setAttribute("class", "chatbub");
        channel.addEventListener("click", disp);
        channel.appendChild(text);
        channelplace.appendChild(channel);
        focelem = channelplace;
        lstid = channelplace.id;
        socket.emit('userjoin', {channel: channel.textContent, select: 'channel'});
      }
      else
      {
        element.appendChild(br);
        element.appendChild(load);
        load.setAttribute("id", "false");
        load.setAttribute("class", "load");
        channelplace.className = cl;
        channelplace.setAttribute("id", x);
        x = x + 1;
        load.appendChild(channelplace);
        channel.setAttribute("class", "chatbub");
        channel.addEventListener("click", disp);
        channel.appendChild(text);
        channelplace.appendChild(channel);
        lstid = channelplace.id;
        focelem = channelplace;
        channeload = true;
      }
    }

  }
  else
  {
      
    if(channelname == null || channelname == "")
    {

    }
    else
    {
      if(channeload == true)
      {
        element.appendChild(br);
        element.appendChild(load);
        load.setAttribute("id", "true");
        load.setAttribute("class", "load");
        channelplace.className = cl;
        channelplace.setAttribute("id", x);
        x = x + 1;
        load.appendChild(channelplace);
        channel.setAttribute("class", "chatbub");
        channel.addEventListener("click", disp);
        channel.appendChild(text);
        channelplace.appendChild(channel);
        socket.emit('userjoin', {channel: channel.textContent, select: 'channel'});

        }
      else
      {
        element.appendChild(br);
        element.appendChild(load);
        load.setAttribute("id", "false");
        load.setAttribute("class", "load");
        channelplace.className = cl;
        channelplace.setAttribute("id", x);
        x = x + 1;
        load.appendChild(channelplace);
        channel.setAttribute("class", "chatbub");
        channel.addEventListener("click", disp);
        channel.appendChild(text);
        channelplace.appendChild(channel);
        lstid = channelplace.id;
        focelem = channelplace;
        channeload = true;
      }
    }

  }
  
}

function newchat(response)
{
  namespace = '/test';
  var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);
  if(focelem.parentElement.id == 'true')
  {
    var chatname = prompt("Name your new chat.", "");
  }
  else
  {
    ////Fix the general name in one of the channels later
    if(response == '#general' || response =='general')
    {
      
    }
    else
    {
      var chatname = response;
    }
  }

  var chat = document.createElement("button");
  var chats = "chat" + focelem.id;
  
  if(chatname == null || chatname == "")
  {
    
  }
  else
  {
    if(focelem.parentElement.id == 'true')
    {
      if(firstchat == false)
      {
        chatname = "#" + chatname;
        var text = document.createTextNode(chatname);
        chat.addEventListener("click", disp);
        chat.className = "smallchatbub";
        chat.appendChild(text);
        document.getElementById(chats).appendChild(chat);
        socket.emit('userjoin', {channel: focelem.firstChild.textContent, select: 'chat', chatname: chatname})
      }
      else
      {
        chatname = "#" + chatname;
        var text = document.createTextNode(chatname);
        chatplace = document.createElement("div");
        chatplace.setAttribute("id", chats);
        firstchat = false;
        focelem.appendChild(chatplace);  
        chat.addEventListener("click", disp);
        chat.className = "smallchatbub";
        chat.appendChild(text);
        chatplace.appendChild(chat);
        socket.emit('userjoin', {channel: focelem.firstChild.textContent, select: 'chat', chatname: chatname})
      }
    }
    else
    {
      if(firstchat == false)
      {
        var text = document.createTextNode(chatname);
        chat.addEventListener("click", disp);
        chat.className = "smallchatbub";
        chat.appendChild(text);
        document.getElementById(chats).appendChild(chat);
      }
      else
      {
        var text = document.createTextNode(chatname);
        chatplace = document.createElement("div");
        chatplace.setAttribute("id", chats);
        firstchat = false;
        focelem.appendChild(chatplace);  
        chat.addEventListener("click", disp);
        chat.className = "smallchatbub";
        chat.appendChild(text);
        chatplace.appendChild(chat);
      }
    }
  }
}
</script>
</html>